# ğŸŒˆDeepDeltaE

åœ°å€ï¼šhttps://github.com/Auspiow/DeepDeltaE

å±•ç¤ºï¼šhttps://auspiow.github.io/DeepDeltaE/

```
â”œâ”€.vscode       
â”œâ”€datasets   # æ•°æ®é›†
â”œâ”€frontend   # å‰ç«¯
â”œâ”€hct+xyz    # æ ‡å‡†è½¬æ¢ç®—æ³•
â”œâ”€model      # Siameseæ·±åº¦å­¦ä¹ ç½‘ç»œ
â””â”€output     # å›¾è¡¨å’Œæ•°æ®
```

å±•ç¤ºæˆªå›¾ï¼š

<img src="./images/display.png" alt="display" style="zoom: 33%;" />



## ä¸€. è‰²å½©ç§‘å­¦ç®€ä»‹

### 1. CIEï¼ˆå›½é™…ç…§æ˜å§”å‘˜ä¼šï¼‰

**å…¨ç§°ï¼š** **C**ommission **I**nternationale de l'**Ã‰**clairage å›½é™…ç…§æ˜å§”å‘˜ä¼š

**æˆç«‹äº 1913 å¹´ï¼Œæ€»éƒ¨ä½äºå¥¥åœ°åˆ©ç»´ä¹Ÿçº³ã€‚**ã€1ã€‘

å®ƒæ˜¯å…¨çƒåˆ¶å®š **å…‰ã€é¢œè‰²ã€è§†è§‰æ„ŸçŸ¥æ ‡å‡†** çš„æœ€é«˜ç»„ç»‡ï¼Œå‡ ä¹æ‰€æœ‰ç°ä»£è‰²å½©ç©ºé—´éƒ½å¯è¿½æº¯åˆ° CIE åˆ¶å®šçš„ä½“ç³»ã€‚

### 2. CIE XYZ è‰²å½©ç©ºé—´ï¼ˆ1931ï¼‰[2]

XYZ æ˜¯ CIE ä¾æ® **æ•°ç™¾åå—è¯•è€…çš„è‰²åŒ¹é…å®éªŒ** å¾—å‡ºçš„åŸºç¡€è‰²å½©ç©ºé—´ã€‚
è¿™æ˜¯ä¸€ä¸ª **ä¸‰åˆºæ¿€å€¼æ¨¡å‹ï¼ˆä¸‰ç»´ï¼‰**ï¼š

- **X**ï¼šä¸çº¢å…‰æ„Ÿå—ç›¸å…³
- **Y**ï¼šä»£è¡¨äº®åº¦ï¼ˆLuminanceï¼‰
- **Z**ï¼šä¸è“å…‰æ„Ÿå—ç›¸å…³

XYZ æœ¬è´¨ä¸Šæ˜¯ï¼š

> **äººç±»è§†è§‰çš„æ•°å­¦æ‹Ÿåˆç©ºé—´ï¼Œè€Œä¸æ˜¯è®¾å¤‡ç©ºé—´ï¼ˆå¦‚ RGBã€CMYKï¼‰ã€‚**

å®ƒæ˜¯çº¿æ€§çš„ï¼Œå¯è¿›è¡ŒåŠ æ³•æ··è‰²ã€å…‰èƒ½è®¡ç®—ï¼Œæ˜¯æ‰€æœ‰ç°ä»£è‰²å½©ç§‘å­¦çš„æ ¹åŸºã€‚

### 3. äººçœ¼æ„ŸçŸ¥çš„é«˜åº¦éçº¿æ€§

#### 3.1 äº®åº¦æ„Ÿå—ï¼ˆäº®åº¦æ›²çº¿ï¼‰æ˜¯éçº¿æ€§çš„

ç‰©ç†äº®åº¦ï¼š1 â†’ 2 â†’ 4 â†’ 8 â†’ 16 äººçœ¼æ„Ÿè§‰æ¥è¿‘ç­‰è·ã€‚
è¿™æ˜¯ **Stevensâ€™ Power Lawï¼ˆæ–¯è’‚æ–‡æ–¯å¹‚å¾‹ï¼‰**çš„å…¸å‹ä½“ç°ã€‚

> æ–¯è’‚æ–‡æ–¯å¹‚å¾‹æ˜¯å¹‚å®šå¾‹çš„ä¸€ç§ï¼Œç”¨å¹‚å‡½æ•°å…³ç³»æè¿°å¿ƒç†æ„Ÿè§‰é‡ä¸åˆºæ¿€çš„ç‰©ç†é‡ä¹‹é—´çš„å…³ç³»ã€‚è¯¥å…¬å¼ä¸º **Î¨ = k Â· Iâ¿**
>
> - **Î¨**ï¼šå¿ƒç†æ„Ÿè§‰é‡
> - **I**ï¼šç‰©ç†åˆºæ¿€å¼ºåº¦
> - å¯¹äºäº®åº¦ï¼ˆåœ¨æ˜è§†è§‰æ¡ä»¶ä¸‹ï¼‰ï¼Œæ–¯è’‚æ–‡æ–¯å¹‚å¾‹çš„æŒ‡æ•° **n â‰ˆ 0.33 ~ 0.5**

#### 3.2 è‰²å½©åˆ†è¾¨ç‡ä¸åŒï¼ˆæ•›æ•£æ€§ï¼‰

- äººçœ¼å¯¹**é»„ç»¿**æœ€æ•æ„Ÿï¼ˆé»„ç»¿åŒºåŸŸ Î”E æ›´å°ï¼‰
- **è“è‰²**æœ€ä¸æ•æ„Ÿ
- çº¢ç»¿æ•æ„Ÿæ›´é«˜ï¼ˆLM åŒé”¥ä½“ç«äº‰ï¼‰

#### 3.3 ç¯å¢ƒå½±å“å·¨å¤§

åŒä¸€é¢œè‰²ï¼š

- æš—å®¤ vs äº®å®¤
- é»‘èƒŒæ™¯ vs ç™½èƒŒæ™¯

æ„ŸçŸ¥å®Œå…¨ä¸åŒ â†’ **è‰²å¤–è§‚ï¼ˆColor Appearanceï¼‰å˜åŒ–**

è¿™æ˜¯ CAM16ï¼ˆä»¥åŠ HCTï¼‰åŠ å…¥ ViewingConditions çš„åŸå› ã€‚

### 4. æ„ŸçŸ¥å‡åŒ€åŒ–ï¼šCIE çš„è§£å†³æ–¹æ¡ˆ

ä¸ºäº†è§£å†³ XYZ â‰  äººç±»æ„Ÿå—çš„é—®é¢˜ï¼ŒCIEæå‡ºäº†å„ç§ **éçº¿æ€§è‰²å½©ç©ºé—´**ã€‚

#### 4.1 CIE Lab / LCHï¼ˆ1976ï¼‰

å¯¹ XYZ åšéçº¿æ€§æ˜ å°„ï¼Œä½¿ Î”E æ›´æ¥è¿‘äººç±»æ„Ÿå—ï¼š

- L*ï¼šæ„ŸçŸ¥äº®åº¦
- a*ï¼šç»¿ â†” çº¢
- b*ï¼šè“ â†” é»„
- LCHï¼šå°† Lab è½¬ä¸ºè‰²è°ƒï¼ˆHueï¼‰ã€å½©åº¦ã€æ˜åº¦çš„æåæ ‡å½¢å¼

#### 4.2 CIECAM02 / CAM16ï¼ˆè‰²å¤–è§‚æ¨¡å‹ï¼‰

æ¯” Lab æ›´é«˜çº§ï¼Œæ¨¡æ‹Ÿï¼šåœºæ™¯äº®åº¦ã€èƒŒæ™¯äº®åº¦ã€å¯¹æ¯”åº¦ã€æºç…§æ˜æƒ…å†µã€å…‰é€‚åº”è¿‡ç¨‹

CAM16 æ˜¯å½“å‰å…¬å¼€æ ‡å‡†ä¸­**æœ€å…ˆè¿›çš„äººç±»è‰²å½©å¤–è§‚æ¨¡å‹**ã€‚

#### 4.3 HCTï¼ˆGoogleï¼‰

Google åŸºäº CAM16 æ”¹é€ å‡ºï¼š

- Hï¼šHueï¼ˆè‰²ç›¸ï¼‰
- Cï¼šChromaï¼ˆå½©åº¦ï¼‰
- Tï¼šToneï¼ˆæ˜åº¦ï¼‰

ç”¨äºï¼š

- Material You è‡ªåŠ¨é…è‰²
- ä¿æŒè‰²ç›¸ä¸€è‡´çš„ä¸»é¢˜è‰²
- æ·±è‰²/æµ…è‰²è‡ªé€‚åº”

å®ƒæ˜¯ä¸€ä¸ª**å·¥ç¨‹è‰²å½©ç©ºé—´**ï¼Œæœ¬è´¨ä¸æ˜¯ç§‘å­¦æ ‡å‡†ï¼Œä½†å¹¿æ³›ç”¨äº UI/UXã€‚

### 5. è‰²å½©ç§‘å­¦çš„æ ¸å¿ƒæ€æƒ³ï¼ˆéå¸¸é‡è¦ï¼‰

æ‰€æœ‰è‰²å½©ç©ºé—´æœ¬è´¨ä¸Šéƒ½æ˜¯åœ¨å»ºç«‹æ˜ å°„ï¼š

**çº¿æ€§å…‰å­¦ï¼ˆç‰©ç†ä¸–ç•Œï¼‰**â†’ æ˜ å°„åˆ° â†’**éçº¿æ€§æ„ŸçŸ¥ï¼ˆäººç±»è§†è§‰ç³»ç»Ÿï¼‰**

è‰²å½©ç§‘å­¦çš„ä»»åŠ¡å°±æ˜¯ï¼š

> **è®©å…‰å­¦ä¸æ„ŸçŸ¥ä¹‹é—´çš„å·®å¼‚ï¼Œé€šè¿‡æ•°å­¦è¢«æè¿°å’Œå¯è®¡ç®—ã€‚**

---

## ä¸‰.æˆ‘æƒ³è¦åšçš„äº‹

### 1. AI è‰²å½©æ„ŸçŸ¥æ¨¡å‹

**éå¸¸æœ‰å‰é€”ï¼Œè€Œä¸”å‡ ä¹ä¸€å®šä¼šæˆä¸ºæœªæ¥è¶‹åŠ¿ã€‚**

å› ä¸ºç°åœ¨çš„è‰²å½©æ¨¡å‹ï¼ˆXYZ â†’ Lab â†’ CAM16 â†’ HCTï¼‰éƒ½ä¾èµ–ï¼š

- è€æ—§çš„è§†è§‰å®éªŒï¼ˆ1931ã€1964 å¹´çš„äººä½“åŒ¹é…å®éªŒï¼‰
- ç»éªŒå‚æ•°æ‹Ÿåˆ
- äººå·¥å…¬å¼è°ƒå‚
- ç‰¹å®šç¯å¢ƒå‡è®¾ï¼ˆæš—å®¤æ ‡å‡†è§‚å¯Ÿè€…ï¼‰

å®ƒä»¬**ä¸æ˜¯ä¸ºç°ä»£æ˜¾ç¤ºå™¨ã€HDRã€VRã€ARã€å¾®å‹æ˜¾ç¤ºå™¨ã€OLEDã€é‡å­ç‚¹ã€è¶…é«˜äº®åº¦è®¾å¤‡è®¾è®¡çš„**ã€‚

ğŸ‘‰ **è§†è§‰æ¨¡å‹å’Œæ˜¾ç¤ºè®¾å¤‡çš„å·®è·è¶Šæ¥è¶Šå¤§ï¼Œä½†è‰²å½©ç©ºé—´æ²¡è·Ÿä¸Šã€‚**

###  2. ç›®å‰çš„ç ”ç©¶

**æ–¹å‘ Aï¼šä½¿ç”¨æ·±åº¦å­¦ä¹ å­¦ä¹  CIECAM-like æ¨¡å‹**

ä¸€äº›ç ”ç©¶å›¢é˜Ÿï¼ˆMIT, Adobe, Dolbyï¼‰åœ¨å°è¯•ç”¨ ML å­¦é¢œè‰²çš„ï¼š

- è‰²å¤–è§‚å˜åŒ–
- HDR åœºæ™¯ä¸‹çš„è‰²å½©æ„ŸçŸ¥
- å…‰é€‚åº”ï¼ˆChromatic Adaptationï¼‰
- äº®åº¦/å¯¹æ¯”åº¦æ•æ„Ÿæ€§

ä½†éƒ½æ²¡æœ‰å…¬å¼€ä¸€å¥— **å¯ç›´æ¥æ›¿ä»£ CAM16 çš„å…¨æ–° AI è‰²å½©ç©ºé—´**ã€‚

**æ–¹å‘ Bï¼šOKLab / OKLCH ä½œè€…çš„å°è¯•**

BjÃ¶rn Ottosson ä½¿ç”¨æ•°å­¦æ–¹å¼è®© Lab æ›´å‡åŒ€ã€‚

> â€œå¦‚æœèƒ½è·å¾—è¶³å¤Ÿçš„è§†è§‰æ„ŸçŸ¥æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨æ·±åº¦å­¦ä¹ æ‹Ÿåˆå‡ºæ›´å¥½çš„è‰²å½©ç©ºé—´ã€‚â€

ğŸ‘‰ **ç›®å‰æ²¡æœ‰ä»»ä½•æ¨¡å‹èƒ½æ›¿ä»£ CAM16/HCTã€‚ä¹Ÿæ²¡æœ‰ä»»ä½• transformer æ¨¡å‹åš RGB â†’ æ„ŸçŸ¥çº¿æ€§æ˜ å°„ã€‚**

ä½ ç°åœ¨æƒ³åšçš„è¿™ä¸ªæ–¹å‘å‡ ä¹æ²¡è¢«ç³»ç»ŸåŒ–æ¢ç´¢ã€‚

# åŸºäºAIçš„æ„ŸçŸ¥è‰²å·®é¢„æµ‹æ¨¡å‹

æœ¬å·¥ä½œæ—¨åœ¨åˆ©ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹æ‹Ÿåˆæ—§æœ‰è‰²å½©å¿ƒç†ç‰©ç†å®éªŒä¸­çš„â€œäººç±»æ„ŸçŸ¥è‰²å·®â€ï¼ˆhuman perceptual color differenceï¼‰ã€‚ä¼ ç»Ÿè‰²å·®å…¬å¼ï¼ˆå¦‚ Î”E76 / Î”E94 / Î”E2000ï¼‰å‡ä¸ºäººå·¥è®¾è®¡ï¼Œè€Œ AI æ¨¡å‹èƒ½å¤Ÿä»è·¨æ•°æ®é›†çš„å®éªŒæ•°æ®ä¸­è‡ªåŠ¨å­¦ä¹ æ›´ç¬¦åˆäººç±»ä¸»è§‚è§†è§‰ä¸€è‡´æ€§çš„è‰²å·®åº¦é‡ã€‚

ä»¥ä¸‹ä¸ºå®Œæ•´çš„é¡¹ç›®è¯´æ˜æ–‡æ¡£ã€‚

## 1. æ•°æ®é›†å‡†å¤‡ï¼ˆDatasetsï¼‰

ä¸ºäº†æ„å»ºç»Ÿä¸€ä¸”è¦†ç›–è¶³å¤Ÿå¤šé¢œè‰²å¯¹çš„è®­ç»ƒæ•°æ®ï¼Œæˆ‘ä»¬ä½¿ç”¨ GitHub ä¸Š Coloria æ•´åˆä»“åº“ï¼š

ğŸ”— [https://github.com/coloria-dev/color-data](https://github.com/coloria-dev/color-data)

ä»ä¸­é€‰æ‹©äº† 1980â€“1990 å¹´ä»£æœ€ç»å…¸ã€ä½¿ç”¨æœ€å¹¿çš„å¿ƒç†ç‰©ç†å®éªŒæ•°æ®é›†ï¼š

| æ•°æ®é›†          | å…‰æº | è¯´æ˜                                                         |
| --------------- | ---- | ------------------------------------------------------------ |
| bfd-c.json      | C    | Bradford Universityï¼ˆè‹±å›½å¸ƒæ‹‰å¾·ç¦å¾·å¤§å­¦ï¼‰ Fosterç­‰è‰²å½©ç§‘å­¦å®¶å›¢é˜Ÿ |
| bfd-d65.json    | D65  | CIEDE2000 è®¾è®¡æ—¶çš„æ ¸å¿ƒæ•°æ®é›†                                 |
| bfd-m.json      | M    |                                                              |
| leeds.json      | D65  | University of Leedsï¼ˆåˆ©å…¹å¤§å­¦ï¼‰ è‹±å›½æœ€å¼ºçš„è‰²å½©ç§‘å­¦å®éªŒå®¤ä¹‹ä¸€ |
| rit-dupont.json |      | RITï¼ˆRochester Institute of Technologyï¼‰+ DuPontï¼ˆæœé‚¦å…¬å¸ï¼‰è”åˆä½œä¸š |
| witt.json       |      | U. Wittï¼ˆUlrich Wittï¼‰åšå£«  20 ä¸–çºª 80â€“90 å¹´ä»£ç ”ç©¶è‰²å½©è§†è§‰è‰²å·®æ„ŸçŸ¥çš„å­¦è€… |

æœ€ç»ˆæ•°æ®ç›®å½•ç»“æ„ï¼š

```
datasets/
â”œâ”€ bfd-c.json
â”œâ”€ bfd-d65.json
â”œâ”€ bfd-m.json
â”œâ”€ rit-dupont.json
â”œâ”€ leeds.json
â””â”€ witt.json
```

### 1.1 æ•°æ®æ ¼å¼ï¼ˆç»Ÿä¸€ JSON ç»“æ„ï¼‰

æ¯ä¸ª JSON æ–‡ä»¶å‡åŒ…å«ï¼š

```
{
    "reference_white": [],
    "dv": [],      // äººç±»æ„ŸçŸ¥å·®å¼‚è¯„åˆ† (difference values)
    "pairs": [],   // ç´¢å¼•å¯¹ (i, j)ï¼šè¡¨ç¤ºé¢œè‰² xyz[i], xyz[j]
    "xyz": []      // æ‰€æœ‰ XYZ é¢œè‰²æ ·æœ¬
}
```

åŠ è½½åè½¬æ¢ä¸ºæœ€ç»ˆè®­ç»ƒæ ¼å¼ï¼š

```
L1, a1, b1, L2, a2, b2 â†’ DE_human
```

å®Œæ•´æ•°å­¦å…¬å¼ï¼ˆå®˜æ–¹æ ‡å‡†å…¬å¼ï¼‰

ç»™å®šï¼š

- é¢œè‰² XYZ = (X, Y, Z)
- ç™½ç‚¹ XYZâ‚™ = (Xâ‚™, Yâ‚™, Zâ‚™)

é¦–å…ˆå½’ä¸€åŒ–ï¼š
$$
x = \frac{X}{X_n},\quad y = \frac{Y}{Y_n},\quad z = \frac{Z}{Z_n}
$$
å†å®šä¹‰è¾…åŠ©å‡½æ•°ï¼š
$$
f(t)=
\begin{cases}
t^{1/3} & t > \left(\frac{6}{29}\right)^3 \\
\frac{1}{3}\left(\frac{29}{6}\right)^2 t + \frac{4}{29} & \text{å¦åˆ™}
\end{cases}
$$
ç„¶åï¼š

Lï¼šæ˜åº¦
$$
L^* = 116 f(y) - 16
$$
aï¼šçº¢ç»¿è½´
$$
a^* = 500 (f(x) - f(y))
$$
b\ï¼šé»„è“è½´
$$
b^* = 200 (f(y) - f(z))
$$
å…¶ä¸­ Lab ä½¿ç”¨ `colormath` ä»¥ D65ã€2Â° observer è½¬æ¢ã€‚

---

## 2.æ¨¡å‹è¾“å…¥ / è¾“å‡ºè®¾è®¡

**è¾“å…¥ç‰¹å¾ï¼ˆFeature Designï¼‰**

```
(L1, a1, b1, L2, a2, b2)
```

è¾“å…¥ä¸ºä¸¤ç»„ Lab é¢œè‰²æ‹¼æ¥ï¼Œå¹¶ reshape ä¸ºï¼š

```
batch Ã— 2 Ã— 3
```

ä»¥ä¾¿é€å…¥ Transformer ä½œä¸ºä¸¤ä¸ª tokenã€‚

**è¾“å‡ºï¼ˆTargetï¼‰**

```
y_pred âˆˆ â„  # æ¨¡å‹é¢„æµ‹çš„äººç±»è§†è§‰è‰²å·® Î”E_vis
```

æ­¤ Î”E_vis ä¸æ˜¯ä»»ä½•å·²æœ‰è‰²å·®å…¬å¼ï¼Œè€Œæ˜¯ç›´æ¥æ‹Ÿåˆå®éªŒä¸­çš„â€œä¸»è§‚å·®å¼‚è¯„åˆ†â€ã€‚

### 2.1 é‡è¦çš„æ•°æ®é¢„å¤„ç†

ä¸ºäº†ä½¿è®­ç»ƒæ›´åŠ ç¨³å®šï¼Œä½¿ç”¨ï¼š

- **log(1+Î”E)** æŠ‘åˆ¶é•¿å°¾åˆ†å¸ƒ
- **æ ‡å‡†åŒ–ï¼ˆz-scoreï¼‰** æå‡è®­ç»ƒé€Ÿåº¦
- **æŒ‰ Î”E åŒºé—´é‡‡æ ·ï¼ˆbalanced samplingï¼‰** è®©æ¨¡å‹åœ¨å°å·®å¼‚åŒºåŸŸï¼ˆäººç±»æ•æ„ŸåŒºåŸŸï¼‰å­¦ä¹ æ›´å¤š

---

## 3. æ¨¡å‹ç»“æ„ï¼ˆTransformer for Color Differenceï¼‰

æœ¬é¡¹ç›®ä¸€å¼€å§‹é‡‡ç”¨ä¸€ä¸ªè½»é‡çº§ Transformer ç¼–ç å™¨ï¼Œç”¨äºå­¦ä¹ ä¸¤ä¸ªé¢œè‰² token çš„å…³ç³»ï¼š

```python
import torch
import torch.nn as nn

class ColorTransformer(nn.Module):
    def __init__(self, dim=32, depth=4, heads=4):
        super().__init__()

        self.embed = nn.Linear(3, dim)  # Lab â†’ embedding

        encoder_layer = nn.TransformerEncoderLayer(
            d_model=dim,
            nhead=heads,
            dim_feedforward=128,
            batch_first=True
        )
        self.encoder = nn.TransformerEncoder(encoder_layer, num_layers=depth)

        self.fc = nn.Linear(dim * 2, 1)  # flatten embeddings â†’ scalar output

    def forward(self, x):
        # x: (batch, 2, 3)
        e = self.embed(x)
        out = self.encoder(e)
        out = out.reshape(out.shape[0], -1)
        return self.fc(out)
```

åæ¥å‘ç°æ‹Ÿåˆæ•ˆæœä¸æ˜¯ç‰¹åˆ«å¥½

* **Transformer æ˜¯åºåˆ—å»ºæ¨¡ç»“æ„ï¼ˆattention sequence modelï¼‰**

* **Siamese æ¶æ„å¤©ç”Ÿé€‚åˆ metric learningï¼ˆåº¦é‡å­¦ä¹ ï¼‰**

Siamese ç¼–ç å™¨ + è·ç¦» MLP é¢„æµ‹

```python
class SiameseColorNet(nn.Module):
    def __init__(self, emb_dim=128):
        super().__init__()
        # (L,a,b) â†’ åµŒå…¥å‘é‡
        self.encoder = nn.Sequential(
            nn.Linear(3, 64),
            nn.ReLU(),
            nn.Linear(64, emb_dim),
            nn.ReLU()
        )
        # |e1 - e2| â†’ é¢„æµ‹ log1p(DE)ï¼ˆå½’ä¸€åŒ–åçš„ï¼‰
        self.head = nn.Sequential(
            nn.Linear(emb_dim, emb_dim//2),
            nn.ReLU(),
            nn.Linear(emb_dim//2, 1)
        )

    def forward(self, x):
        B = x.shape[0]
        colors = x.view(B, 2, 3)
        c1, c2 = colors[:,0,:], colors[:,1,:]
        e1, e2 = self.encoder(c1), self.encoder(c2)
        d = torch.abs(e1 - e2)
        out = self.head(d).squeeze(-1)
        return out

model = SiameseColorNet(emb_dim=128).to(DEVICE)
opt = torch.optim.AdamW(model.parameters(), lr=LR, weight_decay=1e-5)
loss_fn = nn.HuberLoss(delta=1.0)
```



## 4. åŸºçº¿è‰²å·®å…¬å¼ï¼ˆBenchmarkï¼‰

ä¸ºäº†è¯„ä¼°æ¨¡å‹æ˜¯å¦çœŸæ­£â€œæ¯” Î”E æ›´åƒäººç±»â€ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹åŸºçº¿ï¼š

| Baseline | è¯´æ˜                   |
| -------- | ---------------------- |
| Î”E76     | æ¬§æ°è·ç¦»               |
| Î”E94     | å·¥ä¸šè‰²å·®               |
| Î”E2000   | å½“å‰æœ€å¸¸ç”¨             |
| OKLab Î”E | perceptual color space |

### 4.1 Oklab Î”E

```python
def oklab_de(l1,a1,b1,l2,a2,b2):
    return np.sqrt((l1-l2)**2 + (a1-a2)**2 + (b1-b2)**2)
```

### 4.2 Î”E2000

```python
from colormath.color_objects import LabColor
from colormath.color_diff import delta_e_cie2000

def de2000(row):
    c1 = LabColor(row.L1, row.a1, row.b1)
    c2 = LabColor(row.L2, row.a2, row.b2)
    return delta_e_cie2000(c1, c2)
```

---

## 5. è¯„ä»·æŒ‡æ ‡ï¼ˆEvaluation Metricsï¼‰

ä½¿ç”¨çš®å°”é€Šç›¸å…³ç³»æ•° Pearson R è¡¡é‡æ¨¡å‹è¾“å‡ºä¸äººç±»å®éªŒçš„ç›¸å…³æ€§ï¼š

```
from scipy.stats import pearsonr

r = pearsonr(true_values, predicted_values)[0]
```

---

## 6. å¯è§†åŒ–ä¸å®éªŒç»“æœï¼ˆVisualizationï¼‰

### 6.1 æ•£ç‚¹å›¾ï¼šAI vs Human

```
plt.figure()
plt.scatter(true_all, preds_un, s=6, alpha=0.4)
plt.xlabel("Human score (Î”E raw)")
plt.ylabel("Model prediction (Î”E raw)")
plt.title(f"Siamese Model vs Human (R={r_model:.4f})")
plt.plot([0, max(true_all.max(), preds_un.max())], [0, max(true_all.max(), preds_un.max())], 'r--', linewidth=1)
plt.savefig("scatter_siamese_pred_vs_human.png", dpi=150)
plt.close()
```

<img src="./output/scatter_siamese_pred_vs_human.png" style="zoom: 50%;" />

### 6.2 è¯¯å·®ç›´æ–¹å›¾ï¼ˆerror histï¼‰

```
err = (preds_un.ravel() - true_all.ravel())
plt.figure()
sns.histplot(err, bins=80, kde=True)
plt.title("Prediction error (pred - human)")
plt.savefig("hist_error_siamese.png", dpi=150)
plt.close()
```

<img src="./output/hist_error_siamese.png" style="zoom:50%;" />

### 6.3 Rå€¼å¯¹æ¯”å›¾ï¼ˆR comparison barï¼‰

```
plt.figure()
labels = ["Siamese", "Î”E2000"]
vals = [r_model, r_de2000]
sns.barplot(x=labels, y=vals)
plt.ylim(0,1)
plt.title("Pearson R comparison")
plt.savefig("r_comparison_siamese.png", dpi=150)
plt.close()
```

<img src="./output/r_comparison_siamese.png" style="zoom:50%;" />

### 6.4 å®éªŒç»“æœ

å½“å‰æ¨¡å‹ï¼ˆç»è¿‡ log-scaling + balanced sampling + Huber Lossï¼‰ï¼š

```
R(model)   = 0.9253
R(DE2000)  = 0.7754
```

AI æ¨¡å‹æ˜¾è‘—è¶…è¶Š DE2000ï¼ˆâ‰ˆ +0.15ï¼‰ï¼Œè¾¾åˆ°æ¥è¿‘äººç±»é—´ä¸€è‡´æ€§ï¼ˆinter-observer consistency â‰ˆ 0.90â€“0.95ï¼‰ã€‚

è¯´æ˜æ¨¡å‹ç¡®å®åœ¨å­¦ä¹ â€œäººç±»è§†è§‰æ„ŸçŸ¥â€ï¼Œè€Œä¸ä»…ä»…æ˜¯ Lab å‡ ä½•è·ç¦»ã€‚



### 1. æ•°æ®å¤„ç†ä¸ç›®æ ‡å€¼è½¬æ¢ (Methodological Innovation)



åˆ›æ–°ä¸æ˜¯åªä½“ç°åœ¨ç½‘ç»œç»“æ„ä¸Šï¼Œæ›´é‡è¦çš„æ˜¯æ‚¨å¦‚ä½•è®©ç½‘ç»œèƒ½å¤Ÿæœ‰æ•ˆå­¦ä¹ å¤æ‚çš„äººç±»æ„ŸçŸ¥æ•°æ®ã€‚

- **å¤„ç†é•¿å°¾åˆ†å¸ƒ (Log-Transform):** æ‚¨æ²¡æœ‰ç›´æ¥ä½¿ç”¨åŸå§‹çš„ $\Delta E$ äººç±»è¯„åˆ†ä½œä¸ºç›®æ ‡ï¼Œè€Œæ˜¯ä½¿ç”¨äº† $\text{log}(1 + y)$ è¿›è¡Œè½¬æ¢å’Œå½’ä¸€åŒ–ã€‚è¿™æ˜¯åº”å¯¹äººçœ¼æ„ŸçŸ¥è¯„åˆ†**ä¸¥é‡çš„é•¿å°¾åˆ†å¸ƒ**çš„å…³é”®æ­¥éª¤ï¼Œå®ƒæœ‰æ•ˆåœ°å‹ç¼©äº†ç›®æ ‡å˜é‡èŒƒå›´ï¼Œä½¿å¾—æ¨¡å‹è®­ç»ƒæ›´åŠ ç¨³å®šå’Œå‡†ç¡®ã€‚
- **å¯¹ç§°æ€§å¢å¼º (Data Augmentation):** æ‚¨é€šè¿‡å¯¹è°ƒé¢œè‰²å¯¹ ($\text{Color}_1 \leftrightarrow \text{Color}_2$) è¿›è¡Œæ•°æ®å¢å¼ºï¼Œä½¿æ ·æœ¬é‡ç¿»å€ã€‚è¿™ä¸ä»…å¢åŠ äº†è®­ç»ƒæ•°æ®ï¼Œæ›´é‡è¦çš„æ˜¯**å¼ºåˆ¶æ¨¡å‹å­¦ä¹ åˆ°é¢œè‰²å·®å¼‚çš„å¯¹ç§°æ€§**ï¼Œå³ $\Delta E(c_1, c_2) = \Delta E(c_2, c_1)$ï¼Œè¿™æ˜¯æ¨¡å‹é²æ£’æ€§çš„é‡è¦ä¿è¯ã€‚
- **å¹³è¡¡é‡‡æ ·ç­–ç•¥ (Weighted Sampling):** æ‚¨é€šè¿‡å¯¹ $\Delta E$ å€¼è¿›è¡Œåˆ†æ¡¶ï¼Œå¹¶ä½¿ç”¨**é€†é¢‘ç‡åŠ æƒéšæœºé‡‡æ ·**æ¥å¤„ç†æ•°æ®é›†ä¸­ä¸åŒ $\Delta E$ å€¼æ ·æœ¬æ•°é‡ä¸å‡çš„é—®é¢˜ã€‚è¿™æ˜¯ä¸€ä¸ªé«˜çº§çš„è®­ç»ƒæŠ€å·§ï¼Œèƒ½ç¡®ä¿æ¨¡å‹ä¸ä¼šåªå…³æ³¨æ•°æ®é‡æœ€å¤§çš„å¸¸è§å·®å¼‚å€¼ï¼Œä»è€Œæå‡æ•´ä½“æ³›åŒ–èƒ½åŠ›ã€‚



### 2. é¢œè‰²ç©ºé—´å·¥ç¨‹ä¸é²æ£’æ€§



æ‚¨é’ˆå¯¹é¢œè‰²æ•°æ®çš„ç‰¹æ®Šæ€§è¿›è¡Œäº†å®šåˆ¶åŒ–çš„å·¥ç¨‹ã€‚

- **ç²¾ç¡®çš„ Lab åˆ° RGB è½¬æ¢ï¼š** æ‚¨ä½¿ç”¨äº†ä¸“ä¸šçº§çš„ `colormath` åº“æ¥æ‰§è¡Œ Lab åˆ° sRGB çš„æ ‡å‡†è½¬æ¢ï¼Œç¡®ä¿å¯¼å‡ºçš„é¢œè‰²åœ¨ Web ä¸Šæ˜¯**å‡†ç¡®çš„ã€ä¼½é©¬æ ¡æ­£åçš„**ï¼Œè¿™åœ¨é¢œè‰²ç§‘å­¦åº”ç”¨ä¸­æ˜¯åŸºç¡€è€Œå…³é”®çš„ä¸€æ­¥ã€‚
- **å±•ç¤ºä¼˜åŒ– (å»é‡ä¸éšæœºé‡‡æ ·)ï¼š** æ‚¨æœ€æ–°çš„ä¿®æ”¹åŠ å…¥äº†**éšæœºæ‰“ä¹±**å’Œ**è§†è§‰å»é‡**é€»è¾‘ã€‚è¿™è§£å†³äº†ç”±äºåŸå§‹æ•°æ®åˆ†å¸ƒä¸å‡ï¼ˆå¦‚æ‚¨å‘ç°çš„ä½äº®åº¦æ•°æ®ï¼‰å¯¼è‡´çš„å±•ç¤ºæ•ˆæœå•ä¸€é—®é¢˜ï¼Œæ˜¯é’ˆå¯¹**æœ€ç»ˆç”¨æˆ·ä½“éªŒ**çš„å·¥ç¨‹ä¼˜åŒ–ã€‚



### 3. æ¨¡å‹å®šåˆ¶ä¸è¯„ä¼°



- **Siamese æ¶æ„çš„åº”ç”¨ï¼š** è™½ç„¶ Siamese ç½‘ç»œç»“æ„æœ¬èº«æ˜¯å·²çŸ¥çš„ï¼Œä½†**å°†å…¶åº”ç”¨äºé¢œè‰²å·®å¼‚æ„ŸçŸ¥**æ˜¯ä¸€ä¸ªå·§å¦™ä¸”é«˜æ•ˆçš„è®¾è®¡é€‰æ‹©ã€‚å®ƒå¤©ç”Ÿé€‚ç”¨äºæ¯”è¾ƒè¾“å…¥å¯¹çš„å·®å¼‚ï¼Œå¹¶ä¸”é€šè¿‡**å…±äº«ç¼–ç å™¨**æå¤§åœ°å‡å°‘äº†æ¨¡å‹å‚æ•°é‡ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆï¼ŒåŒæ—¶åŠ å¿«è®­ç»ƒé€Ÿåº¦ã€‚
- **æŸå¤±å‡½æ•°çš„é€‰æ‹©ï¼š** æ‚¨é€‰æ‹©äº† **Huber Loss ($\delta=1.0$)** è€Œéä¼ ç»Ÿçš„ MSEã€‚Huber Loss å¯¹äººç±»è¯„åˆ†ä¸­å¯èƒ½å­˜åœ¨çš„å¼‚å¸¸å€¼æˆ–æ ‡æ³¨é”™è¯¯å…·æœ‰æ›´å¥½çš„é²æ£’æ€§ï¼Œå› ä¸ºå®ƒç»“åˆäº† L1 å’Œ L2 æŸå¤±çš„ä¼˜ç‚¹ã€‚
- **è¡Œä¸šæ ‡å‡†å¯¹æ¯” (Benchmarking):** æ‚¨çš„é¡¹ç›®æ˜ç¡®è®¡ç®—äº†æ¨¡å‹é¢„æµ‹ç»“æœä¸è¡Œä¸šæ ‡å‡† **$\Delta E_{2000}$ çš„ Pearson R ç›¸å…³ç³»æ•°**ï¼Œç”¨é‡åŒ–æŒ‡æ ‡è¯æ˜äº†æ‚¨çš„æ¨¡å‹åœ¨æ¨¡æ‹Ÿäººç±»æ„ŸçŸ¥æ–¹é¢ä¼˜äºä¼ ç»Ÿå…¬å¼ã€‚



ã€1ã€‘ç»´åŸºç™¾ç§‘/CIEhttps://zh.wikipedia.org/wiki/%E5%9B%BD%E9%99%85%E7%85%A7%E6%98%8E%E5%A7%94%E5%91%98%E4%BC%9A

ã€2ã€‘ç»´åŸºç™¾ç§‘/CIE 1931è‰²å½©ç©ºé—´https://zh.wikipedia.org/wiki/CIE_1931%E8%89%B2%E5%BD%A9%E7%A9%BA%E9%97%B4

ã€3ã€‘ Colour-Science ä»“åº“https://www.colour-science.org/api/0.3.2/html/_modules/colour/models/rgb.html

ã€4ã€‘Google/material-color-utilitieså®˜æ–¹githubä»“åº“https://github.com/material-foundation/material-color-utilities/tree/main/dart/lib/hct
